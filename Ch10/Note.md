
There are poorly documented restrictions on streams that interact badly with restrictions on sockets:
Restriction 1: Input functions following output functions.

Restriction 2: Output functions following input functions.